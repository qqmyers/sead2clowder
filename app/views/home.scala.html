@(displayedName: String,  newsfeed: List[models.Event], profile:User, datasets: List[Dataset],  dscomments: Map[UUID, Int], collections:List[Collection], spaces: List[ProjectSpace],
         deletePermission: Boolean,  followers: List[(UUID, String, String, String)], followedUsers: List[(UUID, String, String, String)], followedFiles: List[(UUID, String, String)],
        followedDatasets: List[(UUID, String, String)], followedCollections: List[(UUID, String, String)], followedSpaces: List[(UUID, String, String)], ownProfile: Option[Boolean])(implicit user: Option[models.User])

@import _root_.util.Formatters
@import _root_.util.Formatters.ellipsize

@main(displayedName) {
    <script src="@routes.Assets.at("javascripts/collectionListProcess.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/datasetListProcess.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/spaceListProcess.js")" type="text/javascript"></script>
    <div class="row featurette">
        <div class="col-md-6">
            <h1 class="featurette-heading">@profile.fullName</h1> <a href="@routes.Profile.viewProfileUUID(profile.id)">Profile</a>
            <h2> My Events </h2>
            @for(event <- newsfeed) {
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="media">
                            <div class="media-left">
                                <a href="@routes.Profile.viewProfileUUID(event.user.id)">
                                    <img class="media-object" src="@event.user.avatarURL">
                                </a>
                            </div>
                            <div class="media-body">
                                <a href="@routes.Profile.viewProfileUUID(event.user.id)">
                                    <h4 class="media-heading">@event.user.fullName</h4>
                                </a>
                                @newsfeedCard(event)
                            </div>
                            <div class="media-right">
                            @Formatters.humanReadableTimeSince(event.created)
                            </div>
                        </div>
                    </div>
                </div>
            }
            @if(newsfeed.size < 1) {
                <p>You can follow users, <a href="@routes.Spaces.list("")">spaces</a>, <a href="@routes.Datasets.list("")">datasets</a> and <a href="@routes.Collections.list("")">collections</a>.
                    Any updates on your followed instances will show here.</p>
            }
        </div>
        <div class="col-md-6" id="resources-panel-container">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <h2> My Datasets </h2>
                </div>
                <div class=" col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class=" margin-top-h pull-right"> <a href="@routes.Datasets.list("","",12, None, "", Some(profile.id.stringify))">See More</a></span>
                </div>

                </div>
                <div class="row">

                @datasets.map { dataset =>
                    <div class="post-box col-lg-6 col-md-6 col-sm-6">
                        <div class="panel panel-default">
                            <div class="pull-right">
                                <a href="#" title="Bookmark" class="pull-right bookmark-link"><span class="glyphicon glyphicon-bookmark bookmark"></span></a>
                            </div>
                            <div class="panel-body">
                                @if(!dataset.thumbnail_id.isEmpty){
                                    <a href="@(routes.Datasets.dataset(dataset.id))">
                                        <img class="img-responsive" src="@(routes.Files.thumbnail(UUID(dataset.thumbnail_id.toString().substring(5,dataset.thumbnail_id.toString().length-1))))" alt="Thumbnail of @Html(dataset.name)">
                                    </a>
                                }
                            <div class="caption break-word">
                                <h4><a href="@(routes.Datasets.dataset(dataset.id))">@Html(dataset.name)</a></h4>
                                <p>@Html(ellipsize(dataset.description, 200))</p>
                            </div>
                            </div>
                                <!-- Dataset Info -->
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <span class="glyphicon glyphicon glyphicon-file" title="@dataset.files.size files"></span> @dataset.files.size
                                    <span class="glyphicon glyphicon glyphicon-tags" title="@dataset.tags.size tags"></span>  @dataset.tags.size
                                    <span class="glyphicon glyphicon glyphicon-list" title="@(dataset.metadata.keys.size + dataset.userMetadata.keys.size) metadata fields"></span>  @(dataset.metadata.keys.size + dataset.userMetadata.keys.size)
                                    <span class="glyphicon glyphicon glyphicon-comment" title="@(dscomments.get(dataset.id)) comments"></span>  @(dscomments.get(dataset.id))
                                    @if(user.isDefined) {
                                            <!-- If user can delete, the button is enabled, otherwise the button is present but disabled to provide consistent UE. -->
                                        @if(user.get.identityId.userId.equals(dataset.author.identityId.userId)){
                                            <button onclick="removeDatasetAndRedirect('@(dataset.id)','@(routes.Application.index())')" class="btn btn-link" style="text-align:right" title="Delete Dataset and Enclosed Contents">
                                                <span class="glyphicon glyphicon-trash"></span></button>
                                        } else {
                                            <button disabled onclick="removeDatasetAndRedirect('@(dataset.id)','@(routes.Application.index())')" class="btn btn-link" style="text-align:right" title="Delete Dataset and Enclosed Contents">
                                                <span class="glyphicon glyphicon-trash"></span></button>
                                        }
                                    }
                                </li>
                            </ul>
                        </div>
                    </div>
                }
                @if(datasets.size < 1) {
                    <div class="text-center col-lg-12 col-md-12 col-sm-12 col-xs-12">
                      <div>This area will show all datasets you've created.</div>

                         <div> <a class="btn-link" href="@routes.Datasets.newDataset(None)" title="Create a new dataset">Create Dataset</a></div>
                    </div>
                }
            </div>
            <div class="row top-padding">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <h2> My Collections </h2>
                </div>
                <div class="margin-top-h col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class="pull-right"> <a href="@routes.Collections.list("","",12, None, "", Some(profile.id.stringify))">See More</a></span>
                </div>


            </div>
            <div class="row">
            @collections.map { collection =>
                <div class="post-box col-lg-6 col-md-6 col-sm-6">
                    <div class="panel panel-default">
                        <div class="pull-right">
                            <a href="#" title="Bookmark" class="pull-right bookmark-link"><span class="glyphicon glyphicon-bookmark bookmark"></span></a>
                        </div>
                        <div class="panel-body">
                            @if(!collection.thumbnail_id.isEmpty){
                                <a href="@(routes.Collections.collection(collection.id))">
                                    <img class="img-responsive" src="@(routes.Files.thumbnail(UUID(collection.thumbnail_id.toString().substring(5,collection.thumbnail_id.toString().length-1))))" alt="Thumbnail of @Html(collection.name)">
                                </a>
                            }
                        <div class="caption break-word">
                            <h4><a href="@(routes.Collections.collection(collection.id))">@Html(collection.name)</a></h4>
                            <p>@Html(ellipsize(collection.description, 200))</p>
                        </div>
                        </div>
                            <!-- Collection Info -->
                        <ul class="list-group">
                            <li class="list-group-item">
                                <span class="glyphicon glyphicon glyphicon-file" title="@collection.datasetCount datasets"></span> @collection.datasetCount
                                @if(user.isDefined) {
                                        <!-- If user can delete, the button is enabled, otherwise the button is present but disabled to provide consistent UE. -->
                                    @if(user.get.identityId.userId.equals(collection.author.identityId.userId)){
                                        <button onclick="removeCollectionAndRedirect('@(collection.id)','@(routes.Application.index())')" class="btn btn-link" style="text-align:right" title="Detach Delete the Collection">
                                            <span class="glyphicon glyphicon-trash"></span></button>
                                    } else {
                                        <button disabled onclick="removeCollectionAndRedirect('@(collection.id)','@(routes.Application.index())')" class="btn btn-link" style="text-align:right" title="Detach Delete the Collection">
                                            <span class="glyphicon glyphicon-trash"></span></button>
                                    }
                                }
                            </li>
                        </ul>
                    </div>
                </div>
            }
                @if(collections.size < 1) {
                    <div class="text-center col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div>This area will show all collections you've created</div>

                        <div> <a class="btn-link" href="@routes.Collections.newCollection(None)" title="Create a new collection">Create Collection</a></div>
                    </div>
                }
            </div>
            <div class="row top-padding">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <h2> My Spaces </h2>
                </div>
                <div class="margin-top-h col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class="pull-right"> <a href="@routes.Spaces.list("","",12, "", Some(profile.id.stringify))">See More</a></span>
                </div>

            </div>
            <div class="row">
            @spaces.map { space =>
                <div class="post-box col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <div class="panel panel-default">
                        <div class="pull-right">
                            <a href="#" title="Bookmark" class="pull-right bookmark-link"><span class="glyphicon glyphicon-bookmark bookmark"></span></a>
                        </div>
                        <div class="panel-body">
                            @if(!space.logoURL.isEmpty) {
                                <a href="@routes.Spaces.getSpace(space.id)">
                                    <img class="img-responsive" src="@(space.logoURL)" alt="Thumbnail of @(space.name)">
                                </a>
                            }
                        <div class="caption break-word">
                            <h4 class="no-overflow oneline"><a href="@routes.Spaces.getSpace(space.id)">@space.name</a></h4>
                            <p>@ellipsize(space.description, 200)</p>
                        </div>
                        </div>
                            <!-- Space Info -->
                        <ul class="list-group">
                            <li class="list-group-item">
                                <span class="glyphicon glyphicon-file" title="@space.datasetCount datasets"></span> @space.datasetCount
                                <span class="glyphicon glyphicon-th-large" title="@space.collectionCount collections"></span> @space.collectionCount
                                <span class="glyphicon glyphicon-user" title="@space.userCount users"></span> @space.userCount
                                @if(user.isDefined) {
                                        <!-- If user can delete, the button is enabled, otherwise the button is present but disabled to provide consistent UE. -->
                                    @if(deletePermission || user.get.identityId.userId.equals(space.creator)){
                                        <button onclick="removeSpaceAndRedirect('@(space.id) ',' @(routes.Application.index())')" class="btn btn-link" style="text-align : right" title="Detach Delete the Space">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                    } else {
                                        <button disabled class="btn btn-link" style="text-align : right" title="Detach Delete the Space">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                    }
                                }
                            </li>
                        </ul>
                    </div>
                </div>
            }
                @if(spaces.size < 1) {
                    <div class="text-center col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div>This area will show all spaces you've created. </div>

                        <div> <a class="btn-link" href="@routes.Spaces.newSpace()" title="Create a new space">Create Space</a></div>
                    </div>
                }
            </div>
            <div class="row top-padding">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <h2> Followers </h2>
                </div>
            </div>
            <div class="row">

                @for(row <- followers) {
                    <div class="post-box col-lg-4 col-md-4 col-sm-4 col-xs-6">
                    <div class = "img_wrapper">
                        <div class = "img_hover">
                            <a href="@routes.Profile.viewProfileUUID(row._1)">
                            @row._4
                            </a>
                        </div>
                        <img src="@row._3" class="img_thumbnail">
                    </div>
                    </div>
                }
                @if(followers.size < 1) {
                    <div class="text-center col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        This area will show users that follow you. Ask other users to follow you <a class="btn-link" href="@routes.Profile.viewProfileUUID(profile.id)">here</a>
                    </div>
                }

            </div>

            <div class="row top-padding">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h2> Following</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="panel-group" id="accordion" style="margin-top: 15px">

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Users</a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in">
                            <div class="panel-body caption break-word">
                                <div class="row" style="margin-top : 15px;">
                                @for(userInfo <- followedUsers) {
                                    <div class="post-box col-lg-4 col-md-4 col-sm-4 col-xs-6">
                                    <div class = "img_wrapper">
                                        <div class = "img_hover">
                                            <a href="@routes.Profile.viewProfileUUID(userInfo._1)">
                                            @userInfo._2
                                            </a>
                                            <div>
                                            @if(user != ownProfile) {
                                                <h4>
                                                @if(user.get.followedEntities.filter(x => (x.id == userInfo._1)).nonEmpty) {
                                                    <button id="followButton" type="button"
                                                    class="btn btn-danger"
                                                    data-toggle="button"
                                                    aria-pressed="true"
                                                    autocomplete="off"
                                                    objectId = "@userInfo._1.stringify"
                                                    objectType = "user">
                                                        Unfollow
                                                    </button>
                                                } else {
                                                    <button id="followButton" type="button"
                                                    class="btn btn-success"
                                                    data-toggle="button"
                                                    aria-pressed="false"
                                                    autocomplete="off"
                                                    objectId = "@userInfo._1.stringify"
                                                    objectType = "user">
                                                        Follow
                                                    </button>
                                                }
                                                </h4>
                                                <script src="@routes.Assets.at("javascripts/follow-button.js")" type="text/javascript"></script>
                                            }
                                            </div>
                                        </div>
                                        <img src=@userInfo._4 class="img_thumbnail">
                                    </div>
                                    </div>
                                }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseSpaces">Spaces</a>
                            </h4>
                        </div>
                        <div id="collapseSpaces" class="panel-collapse collapse">
                            <div class="panel-body">
                            @for(info <- followedSpaces) {
                                <div class="col-md-4" style="margin-top : 30 px">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <a href="@routes.Spaces.getSpace(info._1)">@info._2.toString</a>
                                        </div>
                                        <div class="panel-body">
                                        @info._3
                                        </div>
                                        <div class="panel-footer">
                                        @user match {
                                            case Some(viewer) => {
                                                @ownProfile match {
                                                    case Some(sameProfile) => {
                                                        <h4>
                                                            <button
                                                            id="followButton"
                                                            type="button"
                                                            class="
                                                                @if(viewer.followedEntities.filter(x => (x.id == info._1)).nonEmpty) {
                                                                    btn btn-danger
                                                                } else {
                                                                    btn btn-success
                                                                }
                                                            "
                                                            data-toggle="button"
                                                            aria-pressed="
                                                                @if(viewer.followedEntities.filter(x => (x.id == info._1)).nonEmpty) {
                                                                    true
                                                                } else {
                                                                    false
                                                                }
                                                            "
                                                            autocomplete="off"
                                                            objectType="space"
                                                            objectId="@info._1.stringify"
                                                            >
                                                            @if(viewer.followedEntities.filter(x => (x.id == info._1)).nonEmpty) {
                                                                Unfollow
                                                            } else {
                                                                Follow
                                                            }
                                                            </button>
                                                        </h4>
                                                    }
                                                    case None => {
                                                    }
                                                }
                                            }
                                        }
                                        </div>
                                    </div>
                                </div>
                            }
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">Files</a>
                            </h4>
                        </div>
                        <div id="collapseTwo" class="panel-collapse collapse">
                            <div class="panel-body">
                            @for(fileInfo <- followedFiles) {
                                <div class="col-md-4" style="margin-top: 30px">
                                    <div class="panel panel-default">
                                        <div class="panel-heading caption break-word">
                                            <a href="@routes.Files.file(fileInfo._1)">@fileInfo._2.toString</a>
                                        </div>
                                        <div class="panel-body caption break-word">
                                        @fileInfo._3
                                        </div>
                                        <div class="panel-footer">
                                        @user match {
                                            case Some(viewer) => {
                                                @ownProfile match {
                                                    case Some(sameProfile) => {
                                                        <h4>
                                                            <button
                                                            id="followButton"
                                                            type="button"
                                                            class="
                                                                @if(viewer.followedEntities.filter(x => (x.id == fileInfo._1)).nonEmpty) {
                                                                    btn btn-danger
                                                                }else {
                                                                    btn btn-success
                                                                }
                                                            "
                                                            data-toggle="button"
                                                            aria-pressed="
                                                                @if(viewer.followedEntities.filter(x => (x.id == fileInfo._1)).nonEmpty) {
                                                                    true
                                                                }else {
                                                                    false
                                                                }
                                                            "
                                                            autocomplete="off"
                                                            objectId = "@fileInfo._1.stringify"
                                                            objectType = "file"
                                                            >
                                                            @if(viewer.followedEntities.filter(x => (x.id == fileInfo._1)).nonEmpty) {
                                                                Unfollow
                                                            } else {
                                                                Follow
                                                            }
                                                            </button>
                                                        </h4>
                                                    }
                                                    case None => {
                                                    }
                                                }
                                            }
                                        }
                                        </div>
                                    </div>
                                </div>
                            }
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">Datasets</a>
                            </h4>
                        </div>
                        <div id="collapseThree" class="panel-collapse collapse">
                            <div class="panel-body">
                            @for(datasetInfo <- followedDatasets) {
                                <div class="col-md-4" style="margin-top: 30px">
                                    <div class="panel panel-default">
                                        <div class="panel-heading caption break-word">
                                            <a href="@routes.Datasets.dataset(datasetInfo._1)">@datasetInfo._2.toString</a>
                                        </div>
                                        <div class="panel-body caption break-word">
                                        @datasetInfo._3
                                        </div>
                                        <div class="panel-footer">
                                        @user match {
                                            case Some(viewer) => {
                                                @ownProfile match {
                                                    case Some(sameProfile) => {
                                                        <h4>
                                                            <button
                                                            id="followButton"
                                                            type="button"
                                                            class="
                                                                @if(viewer.followedEntities.filter(x => (x.id == datasetInfo._1)).nonEmpty) {
                                                                    btn btn-danger
                                                                }else {
                                                                    btn btn-success
                                                                }
                                                            "
                                                            data-toggle="button"
                                                            aria-pressed="
                                                                @if(viewer.followedEntities.filter(x => (x.id == datasetInfo._1)).nonEmpty) {
                                                                    true
                                                                }else {
                                                                    false
                                                                }
                                                            "
                                                            autocomplete="off"
                                                            objectType="dataset"
                                                            objectId="@datasetInfo._1.stringify"
                                                            >
                                                            @if(viewer.followedEntities.filter(x => (x.id == datasetInfo._1)).nonEmpty) {
                                                                Unfollow
                                                            } else {
                                                                Follow
                                                            }
                                                            </button>
                                                        </h4>
                                                    }
                                                    case None => {
                                                    }
                                                }
                                            }
                                        }
                                        </div>
                                    </div>
                                </div>
                            }
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">Collections</a>
                            </h4>
                        </div>
                        <div id="collapseFour" class="panel-collapse collapse">
                            <div class="panel-body">
                            @for(collectionInfo <- followedCollections) {
                                <div class="col-md-4" style="margin-top: 30px">
                                    <div class="panel panel-default">
                                        <div class="panel-heading caption break-word">
                                            <a href="@routes.Collections.collection(collectionInfo._1)">@collectionInfo._2.toString</a>
                                        </div>
                                        <div class="panel-body caption break-word">
                                        @collectionInfo._3
                                        </div>
                                        <div class="panel-footer">
                                        @user match {
                                            case Some(viewer) => {
                                                @ownProfile match {
                                                    case Some(sameProfile) => {
                                                        <h4>
                                                            <button
                                                            id="followButton"
                                                            type="button"
                                                            class="
                                                                @if(viewer.followedEntities.filter(x => (x.id == collectionInfo._1)).nonEmpty) {
                                                                    btn btn-danger
                                                                }else {
                                                                    btn btn-success
                                                                }
                                                            "
                                                            data-toggle="button"
                                                            aria-pressed="
                                                                @if(viewer.followedEntities.filter(x => (x.id == collectionInfo._1)).nonEmpty) {
                                                                    true
                                                                }else {
                                                                    false
                                                                }
                                                            "
                                                            autocomplete="off"
                                                            objectType="collection"
                                                            objectId="@collectionInfo._1.stringify"
                                                            >
                                                            @if(viewer.followedEntities.filter(x => (x.id == collectionInfo._1)).nonEmpty) {
                                                                Unfollow
                                                            } else {
                                                                Follow
                                                            }
                                                            </button>
                                                        </h4>
                                                    }
                                                    case None => {
                                                    }
                                                }
                                            }
                                        }
                                        </div>
                                    </div>
                                </div>
                            }

                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        $(document).ready(function() {
            /*
            * Clamped-width.
            * Usage:
            *  <div data-clampedwidth=".myParent">This long content will force clamped width</div>
            *
            * Author: LV
            */
            $('[data-clampedwidth]').each(function () {
                var elem = $(this);
                var parentPanel = elem.data('clampedwidth');
                var resizeFn = function () {
                    var sideBarNavWidth = $(parentPanel).width() - parseInt(elem.css('paddingLeft')) - parseInt(elem.css('paddingRight')) - parseInt(elem.css('marginLeft')) - parseInt(elem.css('marginRight')) - parseInt(elem.css('borderLeftWidth')) - parseInt(elem.css('borderRightWidth'));
                    elem.css('width', sideBarNavWidth);
                };

                resizeFn();
                $(window).resize(resizeFn);
            });

            var panel = $('#resources-panel');
            panel.affix({
                offset: {
                    top: panel.offset() - panel.height()
                }
            });

            var width = $('.col-md-7').width() * 0.05;
            $('.media-object' ).each(function() {
                $(this ).css("width", width);
                $(this ).css("height", width);
            });
        });
    </script>
    <script src="@routes.Assets.at("javascripts/follow-button.js")" type="text/javascript"></script>
    @*******
    *if(user.isDefined) {
    *    @carousel(files)
    *}
    ********@
}
